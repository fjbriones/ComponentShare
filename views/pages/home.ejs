<!DOCTYPE html>
<html lang="en">

<head>
	<% include ../partials/head %>
	<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="/socket.io/socket.io.js"  type="text/javascript"></script>
	<script type="text/javascript">
		
		var socket = io.connect('http://10.158.3.101:3000');
		

		socket.on('user', function(data){
			$("#notifs").append('<li>Connecting</li>');
			console.log("user received");
			var userId = data;

		});

		socket.on('notification', function(channel, notification){
			console.log(channel + ': ' + notification);
			$("#notifs").append('<li>' + channel + ':' + notification+'</li>');
		});

		socket.on('connected', function(){
			var msg = "Push notification enabled";
			$("#notifs").append('<li>' + msg+'</li>');
			console.log(msg);
			socket.emit('join', userId);

		});
	</script>


</head>

<body>

    
<h6 align="right"> Hi, <%= username %>
	<form id="logout" method="get" action="/logout">
		<input type="submit" id="logout" value="Logout" />
	</form>
</h6>

<% include ../partials/side %>

<div id="debug">
</div>

<div class="row">
	<div class="container">
		<div class="column">
			<div class="card">
				<h3>Inventory</h3>
				<br>
				<div class="card2">
					<a href="/addinv">+Add Inventory</a>
				</div>
				<div>
					<ul>
						<% inventory.forEach(function(inv) { %>
						<div>
							<form id="request<%= inv.inv_id %>" method="post" action="/deleteinventory"></form>
						</div>
						<input type="hidden" id="inv_id" name="inv_id" value="<%= inv.inv_id %>" form="request<%= inv.inv_id %>"/>
						<div class="panel-heading">
							<li>
								<h4 class="panel-title"><a data-toggle="collapse" href="#collapseinv<%= inv.inv_id %>">
									<%= inv.quantity %> - <%= inv.item %>
								</a></h4>
								<span class="close" onClick="request<%= inv.inv_id %>.submit()">&times;</span>
							</li>
						</div>
						<div id="collapseinv<%= inv.inv_id %>" class="panel-collapse collapse">
							<% inv.remarks.forEach(function(remark) { %>
								<%= remark %> <br>
							<% }) %>
						</div>
						<% }); %>
					</ul>
				</div>
			</div>
		</div>
	</div>

	<div class="container">
		<div class="column">
			<div class="card">
				<h3>Requests</h3>
				<br> 
				<div class="card2">
					<a href="/addreq">+ Add Requests</a>
				</div>
				<div>
					<ul>
						<% request.forEach(function(req) { %>
						<div>
							<form id="request<%= req.req_id %>" method="post" action="/deleterequest"></form>
						</div>
						<input type="hidden" id="req_id" name="req_id" value="<%= req.req_id %>" form="request<%= req.req_id %>"/>
						<div class="panel-heading">
							<li>
								<h4 class="panel-title"><a data-toggle="collapse" href="#collapsereq<%= req.req_id %>">
									<%= req.quantity %> - <%= req.item %>
								</a></h4>
								<span class="close" onClick="request<%= req.req_id %>.submit()">&times;</span>
							</li>
						</div>
						<div id="collapsereq<%= req.req_id %>" class="panel-collapse collapse">
							<% req.remarks.forEach(function(remark) { %>
								<%= remark %> <br>
							<% }) %>
						</div>
						<% }); %>
          			</ul>
				</div>
			</div>
		</div>
	</div>

	<div class="container">
		<div class="column">
			<div class="card">
				<h3>General Feed</h3>
				<br>
				<div>
					<ul>
						<% feed.forEach(function(item) { %>
						<div class="panel-heading">
							<li>
								<h4 class="panel-title"><a data-toggle="collapse" href="#collapsefeed<%= item.req_id %>">
									<%= item.quantity %> - <%= item.item %>
								</a></h4>
								<span class="close" onClick="request<%= item.req_id %>.submit()">&times;</span>
							</li>
						</div>
						<div id="collapsefeed<%= item.req_id %>" class="panel-collapse collapse">
							<% item.remarks.forEach(function(remark) { %>
								<%= remark %> <br>
							<% }) %>
						</div>
						<% }); %>
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>
<div id="notifbar">
	<h2>Notifications</h2>
	<ul id="notifs"></ul>
</body>
</html>
